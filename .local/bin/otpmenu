#!/bin/sh

prefix=${PASH_DIR-~/.password-store}
set -- "$prefix"/**/*.gpg

for tmp; do
  tmp=${tmp#"$prefix"/}
  tmp=${tmp%.gpg}
  set -- "$@" "$tmp"
  shift
done

password=$(printf '%s\n' "$@" | dmenu -i -c -h 24 -l 20)

test -n "$password" || exit

gpg -q -d "$PASH_DIR"/"$password".gpg |
while read -r line; do
    test "${line%%://*}" = "otpauth" && otpget "$line"
done
