#!/bin/sh
#shopt -s nullglob globstar

typeit=0
test "$1" = "--type" && typeit=1

prefix=${PASH_DIR-~/.local/share/password-store}
set -- $(find $prefix -name "*.gpg")

for tmp; do
  tmp=${tmp#"$prefix"/}
  tmp=${tmp%.gpg}
  set -- "$@" "$tmp"
  shift
done

password=$(printf '%s\n' "$@" | dmenu -i -c -h 24 -l 20)

test -n "$password" || exit

if [ $typeit -eq 0 ]; then
        pash c "$password" 2>/dev/null
else
        pash s "$password" | { IFS= read -r pass; printf %s "$pass"; } |
		xdotool type --clearmodifiers --file -
fi
